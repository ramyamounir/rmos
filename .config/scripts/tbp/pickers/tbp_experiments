#!/usr/bin/env python

import os
import sys
from pathlib import Path


def main() -> int:
    project_root = os.environ.get("PROJECT_ROOT")
    if not project_root:
        print("Error: PROJECT_ROOT environment variable is not set.", file=sys.stderr)
        return 1

    project_root_path = Path(project_root)
    if not project_root_path.exists():
        print(
            f"Error: PROJECT_ROOT does not exist: {project_root_path}", file=sys.stderr
        )
        return 1

    experiment_conf_dir = project_root_path / "conf" / "experiment"
    if not experiment_conf_dir.is_dir():
        print(
            f"Error: experiment config dir does not exist: {experiment_conf_dir}",
            file=sys.stderr,
        )
        return 1

    # Only pick regular files with `.yaml` extension directly under conf/experiment
    yaml_paths = sorted(p for p in experiment_conf_dir.glob("*.yaml") if p.is_file())

    if not yaml_paths:
        print(
            f"Warning: no .yaml configs found in {experiment_conf_dir}", file=sys.stderr
        )
        return 0

    for cfg in yaml_paths:
        # Use the stem as the experiment name (e.g. foo_bar.yaml -> foo_bar)
        name = cfg.stem
        # Second column is "group" just to keep your existing fzf preview happy
        group = cfg.parent.name  # will be "experiment"
        print(f"{name}:{group}")

    return 0


if __name__ == "__main__":
    raise SystemExit(main())
